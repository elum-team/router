import{atom as e,getter as t,setter as a,useGlobalValue as o}from"elum-state";import r from"@vkontakte/vk-bridge";import{useState as p}from"react";const l={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},n={startup:[l],error:[l],main:[l]},s=e({key:"router_active_view",default:"startup"}),u=e({key:"router_active_panel",default:l.panel}),m=e({key:"router_active_modal",default:l.modal}),i=e({key:"router_active_popout",default:l.popout}),f=e({key:"router_active_params",default:l.params}),c=(e,t)=>Object.keys(e).every((a=>e[a]===t[a]||"[object Object]"===Object.prototype.toString.call(e[a])&&c(e[a],t[a]))),d=["view","panel","modal","popout"],y=e=>{const o=t(s),r=e.view||o,p=n[r],y=p[p.length-1],v={panel:e.panel||y.panel,modal:e.modal||y.modal,popout:e.popout||y.popout,stay:e.stay||l.stay,freeze:e.freeze||l.freeze,params:e.params||y.params};for(let t=d.length-1;t>=0;t--){const a=d[t];if(e[a])break;v[a]=l[a]}c(y,v)||(a(s,r),a(u,v.panel),a(m,v.modal),a(i,v.popout),a(f,v.params),p.push(v)),e.clear&&o!==r&&(n[o]=[l])},v=(e={ignoreFreeze:!1,toStay:!1})=>{const o=t(s),p=n[o],l=p[p.length-1],c=((e,t)=>{const a=typeof e;if("boolean"===a&&!e)return t.length-2;let o=0;for(let r=t.length-1;r>0;r--){const p=t[r];if("boolean"===a&&p.stay||p.stay===e){o=r;break}}return o})(e.toStay,p),d=p[c];if(1===p.length)return void r.send("VKWebAppClose",{status:"success"});if(l.freeze&&!e.ignoreFreeze)return;p.splice(c+1);const y={panel:d.panel,modal:d.modal,popout:d.popout,stay:d.stay,freeze:d.freeze,params:d.params};a(s,o),a(u,y.panel),a(m,y.modal),a(i,y.popout),a(f,y.params)},k=()=>{const[e]=p(t(f));return e},b={view:s,panel:u,modal:m,popout:i},g=e=>o(b[e]);export{v as backPage,y as nextPage,k as useParams,g as useRouter};
