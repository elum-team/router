"use strict";var e=require("elum-state"),t=require("@vkontakte/vk-bridge"),o=require("react");const r={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},a={},s=e.atom({key:"router_active_view"}),p=e.atom({key:"router_active_panel"}),l=e.atom({key:"router_active_modal"}),n=e.atom({key:"router_active_popout"}),u=e.atom({key:"router_active_params"}),i=(e,t)=>Object.keys(e).every((o=>e[o]===t[o]||"[object Object]"===Object.prototype.toString.call(e[o])&&i(e[o],t[o]))),c=["view","panel","modal","popout"],m=t=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const o=e.getter(s),m=t.view||o,d=!a[m];d&&(a[m]=[r]);const y=a[m],f=y[y.length-1],g={panel:t.panel||f.panel,modal:t.modal||f.modal,popout:t.popout||f.popout,stay:t.stay||r.stay,freeze:t.freeze||r.freeze,params:t.params||f.params};for(let e=c.length-1;e>=0;e--){const o=c[e];if(t[o])break;g[o]=r[o]}const v=i(f,g);v||y.push(g),o===m&&!d&&v||(e.setter(s,m),e.setter(p,g.panel),e.setter(l,g.modal),e.setter(n,g.popout),e.setter(u,g.params)),t.clear&&o!==m&&(a[o]=[r])},d={view:s,panel:p,modal:l,popout:n};exports.Router=({branch:t,children:r})=>(e.getter(s)||m({view:t}),o.createElement(o.Fragment,null,r)),exports.backPage=(o={ignoreFreeze:!1,toStay:!1})=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const r=e.getter(s),i=a[r],c=i[i.length-1],m=((e,t)=>{const o=typeof e;if("boolean"===o&&!e)return t.length-2;let r=0;for(let a=t.length-1;a>0;a--){const s=t[a];if("boolean"===o&&s.stay||s.stay===e){r=a;break}}return r})(o.toStay||!1,i),d=i[m];if(1===i.length)return void t.send("VKWebAppClose",{status:"success"});if(c.freeze&&!o.ignoreFreeze)return;i.splice(m+1);const y={panel:d.panel,modal:d.modal,popout:d.popout,stay:d.stay,freeze:d.freeze,params:d.params};e.setter(s,r),e.setter(p,y.panel),e.setter(l,y.modal),e.setter(n,y.popout),e.setter(u,y.params)},exports.nextPage=m,exports.useParams=()=>{const[t]=o.useState(e.getter(u));return t},exports.useRouter=t=>e.useGlobalValue(d[t]);
