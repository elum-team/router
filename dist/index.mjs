import{atom as e,getter as t,setter as o,useGlobalValue as a}from"elum-state";import r from"@vkontakte/vk-bridge";import{useState as p}from"react";const l={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},n={},s=e({key:"router_active_view"}),m=e({key:"router_active_panel"}),u=e({key:"router_active_modal"}),i=e({key:"router_active_popout"}),c=e({key:"router_active_params"}),f=(e,t)=>Object.keys(e).every((o=>e[o]===t[o]||"[object Object]"===Object.prototype.toString.call(e[o])&&f(e[o],t[o]))),y=["view","panel","modal","popout"],d=e=>{const a=t(s),r=e.view||a;n[r]||(n[r]=[l]);const p=n[r],d=p[p.length-1],v={panel:e.panel||d.panel,modal:e.modal||d.modal,popout:e.popout||d.popout,stay:e.stay||l.stay,freeze:e.freeze||l.freeze,params:e.params||d.params};for(let t=y.length-1;t>=0;t--){const o=y[t];if(e[o])break;v[o]=l[o]}f(d,v)||(o(s,r),o(m,v.panel),o(u,v.modal),o(i,v.popout),o(c,v.params),p.push(v)),e.clear&&a!==r&&(n[a]=[l])},v=(e={ignoreFreeze:!1,toStay:!1})=>{const a=t(s),p=n[a],l=p[p.length-1],f=((e,t)=>{const o=typeof e;if("boolean"===o&&!e)return t.length-2;let a=0;for(let r=t.length-1;r>0;r--){const p=t[r];if("boolean"===o&&p.stay||p.stay===e){a=r;break}}return a})(e.toStay,p),y=p[f];if(1===p.length)return void r.send("VKWebAppClose",{status:"success"});if(l.freeze&&!e.ignoreFreeze)return;p.splice(f+1);const d={panel:y.panel,modal:y.modal,popout:y.popout,stay:y.stay,freeze:y.freeze,params:y.params};o(s,a),o(m,d.panel),o(u,d.modal),o(i,d.popout),o(c,d.params)},k=()=>{const[e]=p(t(c));return e},b={view:s,panel:m,modal:u,popout:i},g=e=>a(b[e]);export{v as backPage,d as nextPage,k as useParams,g as useRouter};
