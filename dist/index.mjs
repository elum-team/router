import{atom as e,getter as t,setter as o,useGlobalValue as a}from"elum-state";import r from"@vkontakte/vk-bridge";import p,{useState as l,useLayoutEffect as n,Fragment as s}from"react";const c={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},m={},i=e({key:"router_active_view"}),u=e({key:"router_active_panel"}),f=e({key:"router_active_modal"}),y=e({key:"router_active_popout"}),d=e({key:"router_active_params"}),v=(e,t)=>Object.keys(e).every((o=>e[o]===t[o]||"[object Object]"===Object.prototype.toString.call(e[o])&&v(e[o],t[o]))),b=["view","panel","modal","popout"],k=e=>{const a=t(i),r=e.view||a,p=!m[r];p&&(m[r]=[c]);const l=m[r],n=l[l.length-1],s={panel:e.panel||n.panel,modal:e.modal||n.modal,popout:e.popout||n.popout,stay:e.stay||c.stay,freeze:e.freeze||c.freeze,params:e.params||n.params};for(let t=b.length-1;t>=0;t--){const o=b[t];if(e[o])break;s[o]=c[o]}const k=v(n,s);k||l.push(s),!p&&k||(o(i,r),o(u,s.panel),o(f,s.modal),o(y,s.popout),o(d,s.params)),e.clear&&a!==r&&(m[a]=[c])},g=(e={ignoreFreeze:!1,toStay:!1})=>{const a=t(i),p=m[a],l=p[p.length-1],n=((e,t)=>{const o=typeof e;if("boolean"===o&&!e)return t.length-2;let a=0;for(let r=t.length-1;r>0;r--){const p=t[r];if("boolean"===o&&p.stay||p.stay===e){a=r;break}}return a})(e.toStay||!1,p),s=p[n];if(1===p.length)return void r.send("VKWebAppClose",{status:"success"});if(l.freeze&&!e.ignoreFreeze)return;p.splice(n+1);const c={panel:s.panel,modal:s.modal,popout:s.popout,stay:s.stay,freeze:s.freeze,params:s.params};o(i,a),o(u,c.panel),o(f,c.modal),o(y,c.popout),o(d,c.params)},_=()=>{const[e]=l(t(d));return e},h={view:i,panel:u,modal:f,popout:y},z=e=>a(h[e]),w=({branch:e,children:t})=>(n((()=>k({view:e})),[]),p.createElement(s,null,t));export{w as Router,g as backPage,k as nextPage,_ as useParams,z as useRouter};
