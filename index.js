"use strict";var e=require("elum-state"),t=require("@vkontakte/vk-bridge"),a=require("react");const r={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},o={},s=e.atom({key:"router_active_view"}),p=e.atom({key:"router_active_panel"}),l=e.atom({key:"router_active_modal"}),n=e.atom({key:"router_active_popout"}),u=e.atom({key:"router_active_params"}),c=(e,t)=>Object.keys(e).every((a=>e[a]===t[a]||"[object Object]"===Object.prototype.toString.call(e[a])&&c(e[a],t[a]))),m=["view","panel","modal","popout"],i=t=>{const a=e.getter(s),i=t.view||a;o[i]||(o[i]=[r]);const y=o[i],d=y[y.length-1],f={panel:t.panel||d.panel,modal:t.modal||d.modal,popout:t.popout||d.popout,stay:t.stay||r.stay,freeze:t.freeze||r.freeze,params:t.params||d.params};for(let e=m.length-1;e>=0;e--){const a=m[e];if(t[a])break;f[a]=r[a]}c(d,f)||(e.setter(s,i),e.setter(p,f.panel),e.setter(l,f.modal),e.setter(n,f.popout),e.setter(u,f.params),y.push(f)),t.clear&&a!==i&&(o[a]=[r])},y={view:s,panel:p,modal:l,popout:n};exports.Router=({branch:e,children:t})=>(a.useLayoutEffect((()=>i({view:e})),[]),a.createElement(a.Fragment,null,t)),exports.backPage=(a={ignoreFreeze:!1,toStay:!1})=>{const r=e.getter(s),c=o[r],m=c[c.length-1],i=((e,t)=>{const a=typeof e;if("boolean"===a&&!e)return t.length-2;let r=0;for(let o=t.length-1;o>0;o--){const s=t[o];if("boolean"===a&&s.stay||s.stay===e){r=o;break}}return r})(a.toStay,c),y=c[i];if(1===c.length)return void t.send("VKWebAppClose",{status:"success"});if(m.freeze&&!a.ignoreFreeze)return;c.splice(i+1);const d={panel:y.panel,modal:y.modal,popout:y.popout,stay:y.stay,freeze:y.freeze,params:y.params};e.setter(s,r),e.setter(p,d.panel),e.setter(l,d.modal),e.setter(n,d.popout),e.setter(u,d.params)},exports.nextPage=i,exports.useParams=()=>{const[t]=a.useState(e.getter(u));return t},exports.useRouter=t=>e.useGlobalValue(y[t]);
