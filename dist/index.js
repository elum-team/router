"use strict";var e=require("elum-state"),t=require("@vkontakte/vk-bridge"),o=require("react"),r=require("atoms");const a={panel:"default",modal:void 0,popout:void 0,stay:!1,freeze:!1,params:{}},s={},p=e.atom({key:"router_active_view"}),l=e.atom({key:"router_active_panel"}),n=e.atom({key:"router_active_modal"}),u=e.atom({key:"router_active_popout"}),i=e.atom({key:"router_active_params"}),c=(e,t)=>Object.keys(e).every((o=>e[o]===t[o]||"[object Object]"===Object.prototype.toString.call(e[o])&&c(e[o],t[o]))),m=["view","panel","modal","popout"],d=t=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const o=e.getter(p),r=t.view||o,d=!s[r];d&&(s[r]=[a]);const y=s[r],f=y[y.length-1],g={panel:t.panel||f.panel,modal:t.modal||f.modal,popout:t.popout||f.popout,stay:t.stay||a.stay,freeze:t.freeze||a.freeze,params:t.params||f.params};for(let e=m.length-1;e>=0;e--){const o=m[e];if(t[o])break;g[o]=a[o]}const v=c(f,g);v||y.push(g),o===r&&!d&&v||(e.setter(p,r),e.setter(l,g.panel),e.setter(n,g.modal),e.setter(u,g.popout),e.setter(i,g.params)),t.clear&&o!==r&&(s[o]=[a])},y={view:p,panel:l,modal:n,popout:u};exports.Router=({branch:t,children:a})=>(e.getter(r.ACTIVE_VIEW)||d({view:t}),o.createElement(o.Fragment,null,a)),exports.backPage=(o={ignoreFreeze:!1,toStay:!1})=>{"file:"!==window.location.protocol&&window.history.pushState(null,"");const r=e.getter(p),a=s[r],c=a[a.length-1],m=((e,t)=>{const o=typeof e;if("boolean"===o&&!e)return t.length-2;let r=0;for(let a=t.length-1;a>0;a--){const s=t[a];if("boolean"===o&&s.stay||s.stay===e){r=a;break}}return r})(o.toStay||!1,a),d=a[m];if(1===a.length)return void t.send("VKWebAppClose",{status:"success"});if(c.freeze&&!o.ignoreFreeze)return;a.splice(m+1);const y={panel:d.panel,modal:d.modal,popout:d.popout,stay:d.stay,freeze:d.freeze,params:d.params};e.setter(p,r),e.setter(l,y.panel),e.setter(n,y.modal),e.setter(u,y.popout),e.setter(i,y.params)},exports.nextPage=d,exports.useParams=()=>{const[t]=o.useState(e.getter(i));return t},exports.useRouter=t=>e.useGlobalValue(y[t]);
